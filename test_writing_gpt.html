<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Writing GPT Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Test Writing GPT Analysis</h1>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Step 1: Login First</h5>
                <div class="mb-3">
                    <input type="text" id="username" class="form-control mb-2" placeholder="Username (e.g., demo_student)">
                    <input type="password" id="password" class="form-control mb-2" placeholder="Password (e.g., demo123)">
                    <button onclick="login()" class="btn btn-primary">Login</button>
                    <span id="loginStatus" class="ms-3"></span>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Step 2: Test GPT Analysis</h5>
                <div class="mb-3">
                    <label class="form-label">Sample Essay:</label>
                    <textarea id="essay" class="form-control" rows="8">Technology has fundamentally transformed how we communicate in the modern world. Social media platforms like Facebook and Twitter have made it possible to connect with people across the globe instantly. However, this digital revolution has also brought challenges. Many argue that online communication lacks the depth and authenticity of face-to-face interactions. People often present curated versions of themselves online, leading to superficial relationships. Additionally, the constant availability of digital communication can be overwhelming, causing stress and reducing productivity. Despite these drawbacks, technology has democratized information sharing and enabled meaningful connections that would have been impossible in previous generations. The key is finding a balance between digital and in-person communication to maintain genuine human connections while leveraging technology's benefits.</textarea>
                </div>
                <button onclick="analyzeEssay()" class="btn btn-success">Analyze with GPT</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Analysis Results</h5>
                <pre id="results" style="white-space: pre-wrap; max-height: 500px; overflow-y: auto;">
Results will appear here...
                </pre>
            </div>
        </div>
    </div>

    <script>
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const status = document.getElementById('loginStatus');

            if (!username || !password) {
                status.innerHTML = '<span class="text-danger">Please enter username and password</span>';
                return;
            }

            try {
                const response = await fetch('http://localhost:5001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.access_token) {
                    localStorage.setItem('auth_token', data.access_token);
                    status.innerHTML = '<span class="text-success">âœ“ Logged in successfully!</span>';
                } else {
                    status.innerHTML = '<span class="text-danger">Login failed: ' + (data.msg || 'Unknown error') + '</span>';
                }
            } catch (error) {
                status.innerHTML = '<span class="text-danger">Error: ' + error.message + '</span>';
            }
        }

        async function analyzeEssay() {
            const essay = document.getElementById('essay').value;
            const results = document.getElementById('results');
            const token = localStorage.getItem('auth_token');

            if (!token) {
                results.textContent = 'Please login first!';
                return;
            }

            results.textContent = 'Analyzing with GPT... This may take 10-20 seconds...';

            try {
                const response = await fetch('http://localhost:5001/api/writing/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        text: essay,
                        topic: 'argumentative',
                        prompt: 'Analyze the impact of technology on communication'
                    })
                });

                const data = await response.json();

                if (data.success && data.analysis) {
                    results.textContent = 'GPT Analysis Results:\n\n' + JSON.stringify(data.analysis, null, 2);
                } else {
                    results.textContent = 'Analysis failed:\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                results.textContent = 'Error: ' + error.message;
            }
        }

        // Check if already logged in
        if (localStorage.getItem('auth_token')) {
            document.getElementById('loginStatus').innerHTML = '<span class="text-info">Already logged in from previous session</span>';
        }
    </script>
</body>
</html>